<!DOCTYPE html>
<html>
<header>
	<meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="utf-8">
    <title>参照フォーム</title>
</header>
<body>
    <h1>参照フォーム</h1>
    <label for="reference_id">ID : </label>
    <input type="text" value="" id="reference_id">
    <input type="button" value="参照" id="reference_button"><br>
    <label for="pass">PASS: </label>
    <input type="text" value="" id="pass">
    <script>
        const reference_button = document.getElementById("reference_button");
        const message = document.getElementById("msg");

        reference_button.addEventListener('click', () => {

            const idbox = document.getElementById("reference_id");
            const passwordbox = document.getElementById("pass");
            const idvalue = idbox.value;
            const passvalue = passwordbox.value;

            if(idvalue != "" && passvalue != "") {
                const PassCheckrequest = new XMLHttpRequest;
                PassCheckrequest.onreadystatechange = function () {
                    if(this.readyState == 4 && this.status == 200) {
                        const response = this.response;
                        ans = response.user_pass[0].pass;
                        if(passvalue == ans) {

                            console.log('Yes!');
                            const request = new XMLHttpRequest();
                            request.onreadystatechange = function() {
                                if(this.readyState == 4 && this.status == 200) {
                                    console.log('DONE:リクエスト完了');
                                    const responses = this.response;
                                    let div = document.createElement('div');
                                    div.innerText = 'userID: ' + responses.id_user[0].id + '  name: ' + responses.id_user[0].name;
                                    document.body.appendChild(div)
                                }
                            }
                            const URL = '/get/user/n=' + idvalue;
                            request.open('GET', URL, true);
                            request.responseType = 'json';
                            request.send();    
                        }
                        else {
                            console.log('No!');
                        }

                    }
                }
                const pcURL = 'get/user/pass/n=' + idvalue;
                PassCheckrequest.open('GET', pcURL, true);
                PassCheckrequest.responseType = 'json';
                PassCheckrequest.send();
            }
            else if(idvalue == "" && passvalue == "") {
                const div = document.createElement('div');
                div.innerText = 'IDとパスワードを入力してください';
                document.body.appendChild(div)
            }
            else if(idvalue == "") {
                const div = document.createElement('div');
                div.innerText = 'IDを入力してください';
                document.body.appendChild(div)
            }
            else {
                const div = document.createElement('div');
                div.innerText = 'パスワードを入力してください';
                document.body.appendChild(div)
            }
        });
    </script>
</body>
</html>